<!DOCTYPE html>
<!--
	Evandro S. Ortigossa
	M.Sc. Student in Computer Science
	Institute of Mathematical and Computer Sciences - ICMC
	University of São Paulo - USP
	São Carlos, São Paulo, Brazil.
-->

<html>
<head>
	<meta charset="utf-8">
	<title>Aula Visualização - Coordenadas Paralelas</title>

	<script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>

	<style type="text/css">
		
		body {
			font: 12px sans-serif;
		}

		.link path {
			fill: none;
			/*stroke: steelblue;*/
		}

		.setosa {
			stroke: #800; /* vermelho */
		}

		.versicolor {
			stroke: #080; /* verde */
		}

		.virginica {
			stroke: #008; /* azul */
		}

		.axis line,
		.axis path {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
			stroke-width: 2px;
		}

	</style>

</head>
<body>

	<script type="text/javascript">
		
		var margin= {top: 20, right: 30, bottom: 20, left: 30};

		var width= 800- margin.left- margin.right;		
		var height= 600- margin.top- margin.bottom;

		var svg= d3.select("body")
			.append("svg")
			.attr("width", width+ margin.left+ margin.right)
			.attr("height", height+ margin.top+ margin.bottom)
			.append("g")
				.attr("transform", "translate("+ margin.left +", "+ margin.top +")");


		var scaleX= d3.scale.ordinal()
			.rangePoints([0, width]);

		var scaleY= {};

		var line= d3.svg.line();
		var axis= d3.svg.axis().orient("left");

		var dimensions;


		d3.csv("data.csv", function(error, data) {
			if (error) {
				console.log(error);
				return;
			}

			// Extrai a lista de dimensoes e cria uma escala para cada dimensao
			scaleX.domain(dimensions= d3.keys(data[4]).filter(function(d) {
				return d != "species" && (scaleY[d] = d3.scale.linear()
					.domain(d3.extent(data, function(p) { return +p[d]; }))
					.range([height, 0]));
			}));

			var links= svg.append("g")
				.attr("class", "link")
				.selectAll("path")
				.data(data)
				.enter().append("path")
					.attr("d", path)
					.attr("class", function(d) { return d.species; });
					// Classe de cada linha para colorir pela respectiva especie via CSS

			// Adiciona um grupo de elementos para cada dimensao
			var g= svg.selectAll(".dimension")
				.data(dimensions)
				.enter().append("g")
					.attr("class", "dimension")
					.attr("transform", function(d) { return "translate(" + scaleX(d) + ")"; });

			// Adiciona um eixo e seu titulo
			g.append("g")
				.attr("class", "axis")
				.each(function(d) { d3.select(this).call(axis.scale(scaleY[d])); })
				.append("text")
				.style("text-anchor", "middle")
				.attr("y", -10)
				.text(function(d) { return d; });

		});

		// Retorna o caminho para um ponto dos dados
		function path(d) {
			return line(dimensions.map(function(p) { return [scaleX(p), scaleY[p](d[p])]; }));
		};


	</script>

</body>
</html>
